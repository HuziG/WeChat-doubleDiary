!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Bugout=e()}(this,function(){var t={url:{sdkDown:"https://dataapi.testin.cn/sdkDown",track:"https://dataapi.testin.cn/sendEvents"},sdkDown:{pid:"",pl:"miniPrograms",sv:"1.1.0",testin_id:"",testin_time:0,testin_type:"track",testin_name:"testin_bug",testin_first:!0,di:{testin_schan:"testin",testin_av:"",testin_wechat_ver:"",testin_tm:0,testin_pa:"",testin_brand:"",testin_model:"",testin_os:"",testin_ov:"",testin_dh:0,testin_dw:0,testin_lan:"",testin_net:"",testin_bug_type:1,testin_bug_lan:4,testin_component_ver:"",testin_bug_bn:"",testin_bug_pr:"",testin_bug_ww:0,testin_bug_wh:0,testin_bug_sbh:"",testin_bug_fss:"",testin_bus:2}},record:{testin_pid:"",testin_id:"",testin_pl:"miniPrograms",testin_time:0,testin_type:"track",testin_name:"testin_bug",testin_sv:"1.1.0",attrs:{testin_schan:"testin",testin_av:"",testin_wechat_ver:"",testin_tm:0,testin_pa:"",testin_brand:"",testin_model:"",testin_os:"",testin_ov:"",testin_dh:0,testin_dw:0,testin_lan:"",testin_url:"",testin_net:"",testin_bug_type:1,testin_bug_lan:4,testin_component_ver:"",testin_bug_bn:"",testin_bug_stack:"",testin_bug_sv:"1.1.0",testin_bug_pr:"0",testin_bug_ww:0,testin_bug_wh:0,testin_bug_sbh:"",testin_bug_fss:"",testin_bug_rea:"",testin_bug_slog:"",testin_bug_name:"",testin_bus:2}},breadcrumb:[],sdkInitComplete:!1},e={uuid:function(){var t,e,n;!function(){if(!t){var n=new Array(16);e=t=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}}();for(var s="function"==typeof Buffer?Buffer:Array,r=[],i={},o=0;o<256;o++)r[o]=(o+256).toString(16).substr(1),i[r[o]]=o;function a(t,e){var n=e||0,s=r;return s[t[n++]]+s[t[n++]]+s[t[n++]]+s[t[n++]]+"-"+s[t[n++]]+s[t[n++]]+"-"+s[t[n++]]+s[t[n++]]+"-"+s[t[n++]]+s[t[n++]]+"-"+s[t[n++]]+s[t[n++]]+s[t[n++]]+s[t[n++]]+s[t[n++]]+s[t[n++]]}function _(e,n,r){var i=n&&r||0;"string"==typeof e&&(n="binary"===e?new s(16):null,e=null);var o=(e=e||{}).random||(e.rng||t)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n)for(var _=0;_<16;_++)n[i+_]=o[_];return n||a(o)}var u=_;return u.v4=_,u.parse=function(t,e,n){var s=e&&n||0,r=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){r<16&&(e[s+r++]=i[t])});r<16;)e[s+r++]=0;return e},u.unparse=a,u.BufferClass=s,u._rng=t,u._mathRNG=e,u._nodeRNG=void 0,u._whatwgRNG=n,u()},getCurrentPageUrl:function(){var t=getCurrentPages();if(t.length)return t[t.length-1]},getAesKey:function(){var t,e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,s="";for(t=0;t<16;t++)s+=e.charAt(Math.floor(Math.random()*n));return s},reWriteApp:function(t){var e=App,n=this;App=function(s){return["onLaunch","onShow","onHide","onError"].forEach(function(e){var r=s[e];s[e]=function(s){var i={};"onError"===e?(i.testin_bug_s_time=n.nowTime(),i.testin_bug_s_tit="⬆⬆⬆⬆⬆BUG在此⬆⬆⬆⬆⬆",i.testin_bug_s_con="App: "+e):(i.testin_bug_s_time=n.nowTime(),i.testin_bug_s_tit=s.path||"",i.testin_bug_s_con="App: "+e),n.pushToBreadcrumb(i),"onError"===e&&t.track(s),r&&r.call(this,s)}}),e(s)}},reWritePage:function(){var t=this,e=Page;Page=function(n){return Object.keys(n).forEach(function(e){"function"==typeof n[e]&&t.recordPageFn(n,e)}),n.onReady||t.recordPageFn(n,"onReady"),n.onLoad||t.recordPageFn(n,"onLoad"),e(n)}},reWriteWxRequest:function(){var e=this,n=wx.request;try{Object.defineProperty(wx,"request",{configurable:!0,enumerable:!0,writable:!0,value:function(){var s=arguments[0]||{},r=e.nowTime();return s.url.indexOf(t.url.sdkDown)>-1||s.url.indexOf(t.url.track)>-1?n.apply(wx,arguments):(s.complete?e.reWriteComplete(s,r):s.complete=function(t){e.pushToBreadcrumb({testin_bug_s_time:e.nowTime(),testin_bug_s_tit:s.url,testin_bug_s_con:s.method+", status: "+t.statusCode})},n.apply(wx,arguments))}})}catch(t){console.log(t,"此内容为bugout所有~~")}},reWriteComplete:function(t,e){var n=this,s=t.complete;t.complete=function(e){return n.pushToBreadcrumb({testin_bug_s_time:n.nowTime(),testin_bug_s_tit:t.url,testin_bug_s_con:t.method+", status: "+e.statusCode}),s(e)}},reWriteConsole:function(){var t={log:"L",info:"I",error:"E",warn:"W",debug:"D"},e=this;this.consoleList=[],["debug","error","info","log","warn"].forEach(function(n){!function(s){console[n]=function(r){e.consoleList.push(e.nowTimeTrans()+" "+t[n]+"/console(0): "+r),e.consoleList.length>100&&e.consoleList.shift(),s.apply(console,arguments)}}(console[n])})},recordPageFn:function(t,e){var n=t[e],s=this;t[e]=function(){"onLoad"!==e&&"onShow"!==e||(s.activePage=s.getCurrentPageUrl());var t={testin_bug_s_time:s.nowTime(),testin_bug_s_tit:s.activePage?s.activePage.route:"-",testin_bug_s_con:"Page: "+e};return"onLoad"===e&&(t.args=arguments),s.pushToBreadcrumb(t),n&&n.apply(this,arguments)}},nowTime:function(){return(new Date).getTime()},timeZone:function(){return(new Date).getTimezoneOffset()/60},nowTimeTrans:function(){var t=new Date;return(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+((t.getDate()<10?"0"+t.getDate():t.getDate())+" ")+((t.getHours()<10?"0"+t.getHours():t.getHours())+":")+((t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":")+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())+("."+(t.getTime()+"").slice(-3))},pushToBreadcrumb:function(e){t.breadcrumb.push(e),t.breadcrumb.length>100&&t.breadcrumb.shift()},getStorage:function(){var e=this;wx.getStorage({key:"testin_id",success:function(e){t.sdkDown.testin_first=!1,t.sdkDown.testin_id=t.record.testin_eid=t.record.testin_id=e.data},fail:function(){var n=e.uuid();wx.setStorage({key:"testin_id",data:n}),t.sdkDown.testin_first=!0,t.sdkDown.testin_id=t.record.testin_eid=t.record.testin_id=n}})}},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};return{init:function(n,s,r){e.reWriteConsole();if(this.usePlugins||(e.reWriteWxRequest(),e.reWritePage(),e.reWriteApp(this)),"boolean"==typeof n){if(t.sdkDown.di.testin_zone=t.record.attrs.testin_zone=e.timeZone(),t.sdkDown.di.testin_av=t.record.attrs.testin_av=r,e.bugOutPower=n,wx.getAccountInfoSync){var i=wx.getAccountInfoSync();t.sdkDown.di.testin_pa=t.record.attrs.testin_pa=i.miniProgram.appId}t.sdkDown.pid=t.record.testin_pid=s,t.sdkDown.testin_time=e.nowTime(),e.getStorage(),wx.getSystemInfo({success:function(e){var n=e.system.split(" ");t.record.attrs.testin_wechat_ver=t.sdkDown.di.testin_wechat_ver=e.version,t.record.attrs.testin_brand=t.sdkDown.di.testin_brand=e.brand,t.record.attrs.testin_model=t.sdkDown.di.testin_model=e.model,t.record.attrs.testin_os=t.sdkDown.di.testin_os=n[0],t.record.attrs.testin_ov=t.sdkDown.di.testin_ov=n[1],t.record.attrs.testin_dh=t.sdkDown.di.testin_dh=e.screenHeight,t.record.attrs.testin_dw=t.sdkDown.di.testin_dw=e.screenWidth,t.record.attrs.testin_lan=t.sdkDown.di.testin_lan=e.language,t.record.attrs.testin_bug_bn=t.sdkDown.di.testin_bug_bn=e.platform,t.record.attrs.testin_component_ver=t.sdkDown.di.testin_component_ver=e.SDKVersion,t.record.attrs.testin_bug_pr=t.sdkDown.di.testin_bug_pr=e.pixelRatio.toFixed(1),t.record.attrs.testin_bug_ww=t.sdkDown.di.testin_bug_ww=e.windowWidth,t.record.attrs.testin_bug_wh=t.sdkDown.di.testin_bug_wh=e.windowHeight,t.record.attrs.testin_bug_sbh=t.sdkDown.di.testin_bug_sbh=e.statusBarHeight,t.record.attrs.testin_bug_fss=t.sdkDown.di.testin_bug_fss=e.fontSizeSetting,e.batteryLevel&&(t.record.attrs.testin_bat_rem=t.sdkDown.di.testin_bat_rem=e.batteryLevel)},complete:function(){wx.getNetworkType({success:function(e){t.record.attrs.testin_net=t.sdkDown.di.testin_net=e.networkType},complete:function(){wx.request({url:t.url.sdkDown,method:"POST",data:t.sdkDown})}})}})}else console.log("请按照集成文档正确集成SDK")},track:function(s){if(e.bugOutPower){"string"==typeof s&&(t.record.attrs.testin_bug_rea=s.split("\n")[1],t.record.attrs.testin_bug_name=s.split("\n")[0],t.record.attrs.testin_bug_stack=s),"object"===(void 0===s?"undefined":n(s))&&(t.record.attrs.testin_bug_rea=s.message,t.record.attrs.testin_bug_name=s.name,t.record.attrs.testin_bug_stack=s.stack),t.record.attrs.testin_bug_slog=e.consoleList.join("\n"),t.record.attrs.testin_url=e.getCurrentPageUrl()?e.getCurrentPageUrl().route:"",t.record.testin_time=e.nowTime(),t.record.attrs.testin_bug_steps=JSON.stringify(t.breadcrumb);var r=[];r.push(t.record),wx.request({url:t.url.track,method:"POST",data:r})}},usePlugins:!1,metaData:function(e){return t.record.attrs.testin_bug_user=JSON.stringify(Object.assign({},e))}}});
